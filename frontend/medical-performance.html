<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ»ç–—æ•ˆèƒ½ä¼˜åŒ– - æ™ºèƒ½æ•°æ®å¹³å°</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <nav class="navbar">
            <div class="nav-brand">DATA INSIGHTS</div>
            <div class="nav-menu">
                <a class="nav-item" href="dashboard.html">å¸‚åœºæ´å¯Ÿ</a>
                <a class="nav-item" href="competitor.html">ç«å“åˆ†æ</a>
                <a class="nav-item" href="forecast.html">é”€å”®é¢„æµ‹</a>
                <a class="nav-item" href="customer.html">å®¢æˆ·æ´å¯Ÿ</a>
                <a class="nav-item" href="price.html">ä»·æ ¼åˆ†æ</a>
                <a class="nav-item" href="supply-chain.html">æ™ºèƒ½ä¾›åº”é“¾</a>
                <a class="nav-item active" href="medical-performance.html">åŒ»ç–—æ•ˆèƒ½</a>
                <a class="nav-item" href="investment.html">æŠ•èµ„æƒ…æŠ¥</a>
                <a class="nav-item" href="rwa.html">ç ”å‘æ”¯æŒ</a>
                <a class="nav-item" href="assistant.html">AIåŠ©æ‰‹</a>
            </div>
            <div class="nav-user">
                <span class="user-name">{{ userName }}</span>
                <button class="logout-btn" @click="logout">é€€å‡ºç™»å½•</button>
            </div>
        </nav>

        <div class="header">
            <h1>åŒ»ç–—æ•ˆèƒ½ä¼˜åŒ–</h1>
            <p>å¤„æ–¹åˆç†æ€§åˆ†æ Â· æˆæœ¬æ§åˆ¶ Â· DRGç»©æ•ˆ</p>
        </div>

        <div class="container">
            <div v-if="loading" class="loading">æ•°æ®åŠ è½½ä¸­...</div>

            <div v-else>
                <!-- KPIæŒ‡æ ‡ -->
                <div class="kpi-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px;">
                    <div class="kpi-card">
                        <div class="kpi-title">å¤„æ–¹åˆç†ç‡</div>
                        <div class="kpi-value"><span class="number">95.7</span><span class="unit">%</span></div>
                        <div class="kpi-growth up"><span>â†‘</span><span>2.3%</span></div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">å¹³å‡åˆç†åº¦å¾—åˆ†</div>
                        <div class="kpi-value"><span class="number">92.5</span><span class="unit">åˆ†</span></div>
                        <div class="kpi-growth up"><span>â†‘</span><span>1.8%</span></div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">æˆæœ¬èŠ‚çœ</div>
                        <div class="kpi-value"><span class="number">125.8</span><span class="unit">ä¸‡å…ƒ</span></div>
                        <div class="kpi-growth up"><span>â†‘</span><span>15.2%</span></div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">DRGç»©æ•ˆå¾—åˆ†</div>
                        <div class="kpi-value"><span class="number">93.4</span><span class="unit">åˆ†</span></div>
                        <div class="kpi-growth up"><span>â†‘</span><span>3.5%</span></div>
                    </div>
                </div>

                <!-- å›¾è¡¨è¡Œ -->
                <div class="chart-row">
                    <div class="chart-card">
                        <h3>å„ç§‘å®¤å¤„æ–¹åˆç†ç‡</h3>
                        <div ref="rationalityChart" style="width: 100%; height: 350px;"></div>
                    </div>
                    <div class="chart-card">
                        <h3>å¸¸è§é—®é¢˜åˆ†å¸ƒ</h3>
                        <div ref="issuesChart" style="width: 100%; height: 350px;"></div>
                    </div>
                </div>

                <!-- å¤„æ–¹åˆ†æè¡¨æ ¼ -->
                <div class="table-card" style="margin-bottom: 24px;">
                    <h3>å¤„æ–¹åˆç†æ€§åˆ†æ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>åŒ»ç”Ÿ</th>
                                <th>ç§‘å®¤</th>
                                <th>åŒ»é™¢</th>
                                <th>è¯Šæ–­</th>
                                <th>åˆç†åº¦å¾—åˆ†</th>
                                <th>é—®é¢˜</th>
                                <th>å»ºè®®</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="rx in prescriptions" :key="rx.prescription_id">
                                <td>{{ rx.doctor_name }}</td>
                                <td>{{ rx.department }}</td>
                                <td>{{ rx.hospital_name }}</td>
                                <td>{{ rx.diagnosis }}</td>
                                <td :style="{color: rx.rationality_score >= 90 ? '#10b981' : rx.rationality_score >= 80 ? '#f59e0b' : '#ef4444'}">
                                    {{ rx.rationality_score }}åˆ†
                                </td>
                                <td>
                                    <span v-if="rx.issues.length === 0" style="color: #10b981;">æ— </span>
                                    <span v-else style="color: #ef4444;">{{ rx.issues[0] }}</span>
                                </td>
                                <td>
                                    <span class="tag" :class="rx.issues.length === 0 ? 'high' : 'medium'">
                                        {{ rx.suggestions[0].substring(0, 10) }}...
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- æˆæœ¬ä¼˜åŒ– -->
                <div class="table-card" style="margin-bottom: 24px;">
                    <h3>ç”¨è¯æˆæœ¬ä¼˜åŒ–å»ºè®® <span class="badge beta">AIæ¨è</span></h3>
                    <table>
                        <thead>
                            <tr>
                                <th>åŒ»é™¢/ç§‘å®¤</th>
                                <th>ç—…ç§</th>
                                <th>å½“å‰æˆæœ¬</th>
                                <th>ä¼˜åŒ–åæˆæœ¬</th>
                                <th>èŠ‚çœé‡‘é¢</th>
                                <th>èŠ‚çœç‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="opt in optimizations" :key="opt.hospital_name">
                                <td>{{ opt.hospital_name }}/{{ opt.department }}</td>
                                <td>{{ opt.disease }}</td>
                                <td>{{ opt.current_cost.toLocaleString() }}å…ƒ</td>
                                <td>{{ opt.optimized_cost.toLocaleString() }}å…ƒ</td>
                                <td style="color: #10b981;">{{ opt.savings.toLocaleString() }}å…ƒ</td>
                                <td style="color: #10b981;">{{ opt.savings_rate }}%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- åŒ»ç–—å‘Šè­¦ -->
                <div class="table-card">
                    <h3>ä¸è‰¯ç”¨è¯é¢„è­¦</h3>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <div v-for="alert in alerts" :key="alert.message"
                             :class="['alert-' + alert.severity]"
                             style="padding: 16px; margin-bottom: 12px; border-radius: 8px; background: rgba(239, 68, 68, 0.15); border-left: 3px solid #ef4444;">
                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                <strong style="color: #f1f5f9; margin-right: 12px;">{{ alert.doctor }} - {{ alert.department }}</strong>
                                <span style="font-size: 13px; color: #94a3b8;">{{ alert.hospital }}</span>
                            </div>
                            <div style="color: #cbd5e1; margin-bottom: 6px;">{{ alert.message }}: {{ alert.details }}</div>
                            <div style="color: #94a3b8; font-size: 13px;">ğŸ’¡ {{ alert.suggestion }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    loading: true,
                    userName: 'ç®¡ç†å‘˜',
                    token: localStorage.getItem('token'),
                    prescriptions: [],
                    optimizations: [],
                    alerts: []
                };
            },
            mounted() {
                if (!this.token) { window.location.href = 'login.html'; return; }
                this.loadData();
            },
            methods: {
                logout() { localStorage.removeItem('token'); window.location.href = 'login.html'; },
                async loadData() {
                    // æ¨¡æ‹Ÿæ•°æ®
                    this.prescriptions = [
                        {prescription_id: "RX001", doctor_name: "å¼ åŒ»ç”Ÿ", department: "å‘¼å¸å†…ç§‘", hospital_name: "åŒ—äº¬åå’ŒåŒ»é™¢", diagnosis: "æ€¥æ€§æ”¯æ°”ç®¡ç‚", rationality_score: 95, issues: [], suggestions: ["å¤„æ–¹åˆç†"]},
                        {prescription_id: "RX002", doctor_name: "æåŒ»ç”Ÿ", department: "å¿ƒè¡€ç®¡å†…ç§‘", hospital_name: "ä¸Šæµ·ç‘é‡‘åŒ»é™¢", diagnosis: "é«˜è¡€å‹IIçº§", rationality_score: 98, issues: [], suggestions: ["è§„èŒƒç”¨è¯"]},
                        {prescription_id: "RX003", doctor_name: "ç‹åŒ»ç”Ÿ", department: "å„¿ç§‘", hospital_name: "å¹¿å·ä¸­å±±åŒ»é™¢", diagnosis: "ä¸Šå‘¼å¸é“æ„ŸæŸ“", rationality_score: 72, issues: ["é‡å¤ç”¨è¯"], suggestions: ["å–æ¶ˆå¤´å­¢å…‹è‚Ÿ"]},
                        {prescription_id: "RX004", doctor_name: "åˆ˜åŒ»ç”Ÿ", department: "å†…åˆ†æ³Œç§‘", hospital_name: "æˆéƒ½åè¥¿åŒ»é™¢", diagnosis: "2å‹ç³–å°¿ç—…", rationality_score: 92, issues: ["ä¸‰ç§é™ç³–è¯è”ç”¨"], suggestions: ["ç›‘æµ‹è¡€ç³–"]}
                    ];
                    this.optimizations = [
                        {hospital_name: "åŒ—äº¬åå’ŒåŒ»é™¢", department: "å‘¼å¸å†…ç§‘", disease: "ç¤¾åŒºè·å¾—æ€§è‚ºç‚", current_cost: 8520, optimized_cost: 6980, savings: 1540, savings_rate: 18.1},
                        {hospital_name: "ä¸Šæµ·ç‘é‡‘åŒ»é™¢", department: "å¿ƒè¡€ç®¡å†…ç§‘", disease: "é«˜è¡€å‹", current_cost: 12350, optimized_cost: 9850, savings: 2500, savings_rate: 20.2},
                        {hospital_name: "å¹¿å·ä¸­å±±åŒ»é™¢", department: "å†…åˆ†æ³Œç§‘", disease: "2å‹ç³–å°¿ç—…", current_cost: 15680, optimized_cost: 12850, savings: 2830, savings_rate: 18.0}
                    ];
                    this.alerts = [
                        {alert_type: "interaction", severity: "critical", doctor: "ç‹åŒ»ç”Ÿ", hospital: "å¹¿å·ä¸­å±±åŒ»é™¢", department: "å„¿ç§‘", message: "è¯ç‰©ç›¸äº’ä½œç”¨", details: "é˜¿è«è¥¿æ—ä¸å¤´å­¢å…‹è‚Ÿè”ç”¨", suggestion: "å–æ¶ˆä¸€ç§æŠ—ç”Ÿç´ ", created_at: "2025-01-07 10:30"},
                        {alert_type: "dose", severity: "high", doctor: "æåŒ»ç”Ÿ", hospital: "ä¸Šæµ·ç‘é‡‘åŒ»é™¢", department: "è€å¹´ç§‘", message: "å‰‚é‡åé«˜", details: "85å²æ‚£è€…å¸ƒæ´›èŠ¬å‰‚é‡", suggestion: "å»ºè®®å‡åŠ", created_at: "2025-01-07 09:45"}
                    ];
                    this.loading = false;
                    this.$nextTick(() => {
                        this.renderRationalityChart();
                        this.renderIssuesChart();
                    });
                },
                renderRationalityChart() {
                    const chart = echarts.init(this.$refs.rationalityChart);
                    chart.setOption({
                        tooltip: {trigger: 'axis', axisPointer: {type: 'shadow'}},
                        grid: {left: '3%', right: '4%', bottom: '3%', containLabel: true},
                        xAxis: {type: 'category', data: ['å‘¼å¸å†…ç§‘', 'å¿ƒè¡€ç®¡å†…ç§‘', 'å†…åˆ†æ³Œç§‘', 'å„¿ç§‘', 'æ¶ˆåŒ–å†…ç§‘', 'ç¥ç»å†…ç§‘', 'æ€¥è¯Šç§‘'], axisLabel: {color: '#94a3b8', rotate: 45}},
                        yAxis: {type: 'value', name: 'åˆç†ç‡(%)', nameTextStyle: {color: '#94a3b8'}, axisLabel: {color: '#94a3b8'}, splitLine: {lineStyle: {color: 'rgba(99, 102, 241, 0.1)'}}},
                        series: [{
                            type: 'bar',
                            data: [96.8, 96.6, 94.4, 94.0, 96.8, 96.0, 95.4],
                            itemStyle: {color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{offset: 0, color: '#3b82f6'}, {offset: 1, color: '#8b5cf6'}])},
                            barWidth: '50%'
                        }]
                    });
                    window.addEventListener('resize', () => chart.resize());
                },
                renderIssuesChart() {
                    const chart = echarts.init(this.$refs.issuesChart);
                    chart.setOption({
                        tooltip: {trigger: 'item'},
                        legend: {bottom: 10, textStyle: {color: '#94a3b8'}},
                        series: [{
                            type: 'pie',
                            radius: ['40%', '70%'],
                            data: [
                                {value: 185, name: 'é‡å¤ç”¨è¯', itemStyle: {color: '#ef4444'}},
                                {value: 232, name: 'å‰‚é‡ä¸å½“', itemStyle: {color: '#f59e0b'}},
                                {value: 158, name: 'ç–—ç¨‹ä¸å½“', itemStyle: {color: '#3b82f6'}},
                                {value: 45, name: 'é…ä¼ç¦å¿Œ', itemStyle: {color: '#8b5cf6'}},
                                {value: 30, name: 'è¶…è¯´æ˜ä¹¦ç”¨è¯', itemStyle: {color: '#06b6d4'}}
                            ],
                            label: {color: '#cbd5e1'}
                        }]
                    });
                    window.addEventListener('resize', () => chart.resize());
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
