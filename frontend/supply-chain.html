<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ä¾›åº”é“¾ - æ™ºèƒ½æ•°æ®å¹³å°</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .status-normal { color: #10b981; }
        .status-low { color: #f59e0b; }
        .status-out { color: #ef4444; }
        .status-overstock { color: #8b5cf6; }
        .alert-critical { background: rgba(239, 68, 68, 0.15); border-left: 3px solid #ef4444; }
        .alert-high { background: rgba(245, 158, 11, 0.15); border-left: 3px solid #f59e0b; }
        .alert-medium { background: rgba(59, 130, 246, 0.15); border-left: 3px solid #3b82f6; }
        .alert-low { background: rgba(139, 92, 246, 0.15); border-left: 3px solid #8b5cf6; }
    </style>
</head>
<body>
    <div id="app">
        <nav class="navbar">
            <div class="nav-brand">DATA INSIGHTS</div>
            <div class="nav-menu">
                <a class="nav-item" href="dashboard.html">å¸‚åœºæ´å¯Ÿ</a>
                <a class="nav-item" href="competitor.html">ç«å“åˆ†æ</a>
                <a class="nav-item" href="forecast.html">é”€å”®é¢„æµ‹</a>
                <a class="nav-item" href="customer.html">å®¢æˆ·æ´å¯Ÿ</a>
                <a class="nav-item" href="price.html">ä»·æ ¼åˆ†æ</a>
                <a class="nav-item active" href="supply-chain.html">æ™ºèƒ½ä¾›åº”é“¾</a>
                <a class="nav-item" href="medical-performance.html">åŒ»ç–—æ•ˆèƒ½</a>
                <a class="nav-item" href="investment.html">æŠ•èµ„æƒ…æŠ¥</a>
                <a class="nav-item" href="rwa.html">ç ”å‘æ”¯æŒ</a>
                <a class="nav-item" href="assistant.html">AIåŠ©æ‰‹</a>
            </div>
            <div class="nav-user">
                <span class="user-name">{{ userName }}</span>
                <button class="logout-btn" @click="logout">é€€å‡ºç™»å½•</button>
            </div>
        </nav>

        <div class="header">
            <h1>æ™ºèƒ½ä¾›åº”é“¾ç®¡ç†</h1>
            <p>åº“å­˜ä¼˜åŒ– Â· éœ€æ±‚é¢„æµ‹ Â· é£é™©é¢„è­¦</p>
        </div>

        <div class="container">
            <div v-if="loading" class="loading">æ•°æ®åŠ è½½ä¸­...</div>

            <div v-else>
                <!-- KPIæŒ‡æ ‡ -->
                <div class="kpi-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px;">
                    <div class="kpi-card">
                        <div class="kpi-title">åº“å­˜å‘¨è½¬ç‡</div>
                        <div class="kpi-value">
                            <span class="number">7.8</span>
                            <span class="unit">æ¬¡/å¹´</span>
                        </div>
                        <div class="kpi-growth up">
                            <span>â†‘</span>
                            <span>12.5%</span>
                            <span style="margin-left: 4px; color: #64748b;">vs å»å¹´</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">è®¢å•æ»¡è¶³ç‡</div>
                        <div class="kpi-value">
                            <span class="number">97.2</span>
                            <span class="unit">%</span>
                        </div>
                        <div class="kpi-growth up">
                            <span>â†‘</span>
                            <span>2.3%</span>
                            <span style="margin-left: 4px; color: #64748b;">vs ä¸Šæœˆ</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">ç¼ºè´§ç‡</div>
                        <div class="kpi-value">
                            <span class="number">2.8</span>
                            <span class="unit">%</span>
                        </div>
                        <div class="kpi-growth down">
                            <span>â†“</span>
                            <span>15.2%</span>
                            <span style="margin-left: 4px; color: #64748b;">vs ä¸Šæœˆ</span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-title">åº“å­˜å‡†ç¡®ç‡</div>
                        <div class="kpi-value">
                            <span class="number">98.5</span>
                            <span class="unit">%</span>
                        </div>
                        <div class="kpi-growth up">
                            <span>â†‘</span>
                            <span>0.8%</span>
                            <span style="margin-left: 4px; color: #64748b;">vs ä¸Šæœˆ</span>
                        </div>
                    </div>
                </div>

                <!-- å›¾è¡¨è¡Œ -->
                <div class="chart-row">
                    <div class="chart-card">
                        <h3>åº“å­˜çŠ¶æ€åˆ†å¸ƒ</h3>
                        <div ref="inventoryChart" style="width: 100%; height: 350px;"></div>
                    </div>
                    <div class="chart-card">
                        <h3>éœ€æ±‚é¢„æµ‹è¶‹åŠ¿</h3>
                        <div ref="demandChart" style="width: 100%; height: 350px;"></div>
                    </div>
                </div>

                <!-- ä¼˜åŒ–å»ºè®® -->
                <div class="table-card" style="margin-bottom: 24px;">
                    <h3>åº“å­˜ä¼˜åŒ–å»ºè®® <span class="badge beta">AIæ¨è</span></h3>
                    <table>
                        <thead>
                            <tr>
                                <th>äº§å“åç§°</th>
                                <th>å½“å‰ä»“åº“</th>
                                <th>é—®é¢˜</th>
                                <th>ä¼˜å…ˆçº§</th>
                                <th>å»ºè®®æ“ä½œ</th>
                                <th>é¢„è®¡èŠ‚çœæˆæœ¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="suggestion in suggestions" :key="suggestion.product_name">
                                <td>{{ suggestion.product_name }}</td>
                                <td>{{ suggestion.current_warehouse }}</td>
                                <td>{{ suggestion.issue }}</td>
                                <td>
                                    <span class="tag" :class="suggestion.priority === 'critical' ? 'high' : suggestion.priority === 'high' ? 'medium' : 'low'">
                                        {{ suggestion.priority === 'critical' ? 'ç´§æ€¥' : suggestion.priority === 'high' ? 'é«˜' : suggestion.priority === 'medium' ? 'ä¸­' : 'ä½' }}
                                    </span>
                                </td>
                                <td>{{ suggestion.suggested_action }}</td>
                                <td style="color: #10b981;">{{ suggestion.estimated_cost_savings }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- å®æ—¶å‘Šè­¦ -->
                <div class="table-card" style="margin-bottom: 24px;">
                    <h3>å®æ—¶å‘Šè­¦</h3>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <div v-for="alert in alerts" :key="alert.message"
                             :class="['alert-' + alert.severity, 'p-4', 'mb-3', 'rounded', 'flex', 'items-center', 'justify-between']"
                             style="padding: 16px; margin-bottom: 12px; border-radius: 8px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <strong style="color: #f1f5f9; margin-right: 12px;">{{ alert.product_name }}</strong>
                                    <span style="font-size: 13px; color: #94a3b8;">{{ alert.warehouse }}</span>
                                    <span style="font-size: 12px; color: #64748b; margin-left: auto;">{{ alert.created_at }}</span>
                                </div>
                                <div style="color: #cbd5e1; margin-bottom: 6px;">{{ alert.message }}</div>
                                <div style="color: #94a3b8; font-size: 13px;">ğŸ’¡ {{ alert.suggested_action }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä»“åº“ç»©æ•ˆ -->
                <div class="table-card">
                    <h3>ä»“åº“è¿è¥ç»©æ•ˆ</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ä»“åº“åç§°</th>
                                <th>ä½ç½®</th>
                                <th>åº“å­˜å‘¨è½¬ç‡</th>
                                <th>è®¢å•æ»¡è¶³ç‡</th>
                                <th>å¹³å‡å±¥çº¦æ—¶é—´</th>
                                <th>ç¼ºè´§ç‡</th>
                                <th>åº“å­˜å‡†ç¡®ç‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="warehouse in warehouses" :key="warehouse.warehouse_name">
                                <td>{{ warehouse.warehouse_name }}</td>
                                <td>{{ warehouse.location }}</td>
                                <td>{{ warehouse.inventory_turnover_rate }}</td>
                                <td>{{ warehouse.fill_rate }}%</td>
                                <td>{{ warehouse.avg_order_fulfillment_time }}å¤©</td>
                                <td>{{ warehouse.stockout_rate }}%</td>
                                <td>{{ warehouse.accuracy }}%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        const API_BASE = 'http://localhost:8000';

        createApp({
            data() {
                return {
                    loading: true,
                    userName: 'ç®¡ç†å‘˜',
                    token: localStorage.getItem('token'),
                    inventory: [],
                    suggestions: [],
                    alerts: [],
                    warehouses: []
                };
            },
            mounted() {
                if (!this.token) {
                    window.location.href = 'login.html';
                    return;
                }
                this.loadData();
            },
            methods: {
                logout() {
                    localStorage.removeItem('token');
                    window.location.href = 'login.html';
                },
                async loadData() {
                    try {
                        // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
                        this.suggestions = [
                            {
                                product_name: "å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š",
                                current_warehouse: "åå—ä»“",
                                issue: "åº“å­˜åä½",
                                days_until_stockout: 7,
                                suggested_action: "ç«‹å³è¡¥è´§ 15,000 ç›’",
                                reason: "å½“å‰åº“å­˜ä»…å¯æ”¯æ’‘7å¤©,è€Œè¡¥è´§å‘¨æœŸä¸º14å¤©",
                                priority: "high",
                                estimated_cost_savings: "é¿å…æ–­è´§æŸå¤±çº¦ 45ä¸‡å…ƒ"
                            },
                            {
                                product_name: "å¥¥ç¾æ‹‰å”‘è‚ æº¶èƒ¶å›Š",
                                current_warehouse: "ååŒ—ä»“",
                                issue: "ç¼ºè´§",
                                days_until_stockout: 0,
                                suggested_action: "ç´§æ€¥è°ƒè´§ 5,000 ç›’",
                                reason: "å·²å®Œå…¨ç¼ºè´§,éœ€ä»ä¸´è¿‘ä»“åº“ç´§æ€¥è°ƒæ‹¨",
                                priority: "critical",
                                estimated_cost_savings: "é¿å…æ–­è´§æŸå¤±çº¦ 38ä¸‡å…ƒ"
                            },
                            {
                                product_name: "å¤´å­¢å…‹è‚Ÿåˆ†æ•£ç‰‡",
                                current_warehouse: "è¥¿å—ä»“",
                                issue: "åº“å­˜ç§¯å‹",
                                excess_days: 110,
                                suggested_action: "è°ƒæ‹¨ 35,000 ç›’è‡³éœ€æ±‚æ—ºç››åœ°åŒº",
                                reason: "åº“å­˜ç§¯å‹ä¸¥é‡,èµ„é‡‘å ç”¨æˆæœ¬é«˜",
                                priority: "medium",
                                estimated_cost_savings: "å‡å°‘èµ„é‡‘å ç”¨æˆæœ¬çº¦ 12ä¸‡å…ƒ"
                            }
                        ];

                        this.alerts = [
                            {
                                alert_type: "stockout",
                                severity: "critical",
                                product_name: "å¥¥ç¾æ‹‰å”‘è‚ æº¶èƒ¶å›Š",
                                warehouse: "ååŒ—ä»“",
                                message: "äº§å“å·²å®Œå…¨ç¼ºè´§",
                                suggested_action: "ç«‹å³ä»ä¸´è¿‘ä»“åº“è°ƒè´§ 5,000 ç›’",
                                created_at: "2025-01-07 09:30"
                            },
                            {
                                alert_type: "low_stock",
                                severity: "high",
                                product_name: "å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š",
                                warehouse: "åå—ä»“",
                                message: "åº“å­˜ä»…å‰©7å¤©,ä½äºå®‰å…¨åº“å­˜",
                                suggested_action: "å®‰æ’ç´§æ€¥è¡¥è´§ 15,000 ç›’",
                                created_at: "2025-01-07 08:15"
                            },
                            {
                                alert_type: "demand_spike",
                                severity: "medium",
                                product_name: "é˜¿è«è¥¿æ—èƒ¶å›Š",
                                warehouse: "åä¸œä»“",
                                message: "è¿‘3å¤©éœ€æ±‚æ¿€å¢45%",
                                suggested_action: "å¢åŠ å®‰å…¨åº“å­˜è‡³20å¤©",
                                created_at: "2025-01-06 14:20"
                            },
                            {
                                alert_type: "overstock",
                                severity: "low",
                                product_name: "å¤´å­¢å…‹è‚Ÿåˆ†æ•£ç‰‡",
                                warehouse: "è¥¿å—ä»“",
                                message: "åº“å­˜ç§¯å‹140å¤©,èµ„é‡‘å ç”¨é«˜",
                                suggested_action: "è°ƒæ‹¨è‡³éœ€æ±‚æ—ºç››åœ°åŒºæˆ–æš‚åœè¡¥è´§",
                                created_at: "2025-01-05 16:45"
                            }
                        ];

                        this.warehouses = [
                            {
                                warehouse_name: "åä¸œä»“",
                                location: "ä¸Šæµ·",
                                inventory_turnover_rate: 8.5,
                                fill_rate: 98.5,
                                avg_order_fulfillment_time: 1.2,
                                stockout_rate: 1.5,
                                overstock_rate: 3.2,
                                accuracy: 99.2
                            },
                            {
                                warehouse_name: "åå—ä»“",
                                location: "å¹¿å·",
                                inventory_turnover_rate: 7.8,
                                fill_rate: 97.2,
                                avg_order_fulfillment_time: 1.5,
                                stockout_rate: 2.8,
                                overstock_rate: 4.5,
                                accuracy: 98.5
                            },
                            {
                                warehouse_name: "ååŒ—ä»“",
                                location: "åŒ—äº¬",
                                inventory_turnover_rate: 6.9,
                                fill_rate: 95.8,
                                avg_order_fulfillment_time: 1.8,
                                stockout_rate: 4.2,
                                overstock_rate: 5.8,
                                accuracy: 97.3
                            },
                            {
                                warehouse_name: "è¥¿å—ä»“",
                                location: "æˆéƒ½",
                                inventory_turnover_rate: 5.2,
                                fill_rate: 96.5,
                                avg_order_fulfillment_time: 2.1,
                                stockout_rate: 3.5,
                                overstock_rate: 8.9,
                                accuracy: 98.1
                            }
                        ];

                        this.loading = false;
                        this.$nextTick(() => {
                            this.renderInventoryChart();
                            this.renderDemandChart();
                        });
                    } catch (error) {
                        console.error(error);
                        if (error.response?.status === 401) this.logout();
                    }
                },
                renderInventoryChart() {
                    const chart = echarts.init(this.$refs.inventoryChart);

                    const option = {
                        tooltip: {
                            trigger: 'item',
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            borderColor: 'rgba(99, 102, 241, 0.3)',
                            textStyle: { color: '#e2e8f0' }
                        },
                        legend: {
                            bottom: 10,
                            textStyle: { color: '#94a3b8' }
                        },
                        series: [{
                            name: 'åº“å­˜çŠ¶æ€',
                            type: 'pie',
                            radius: ['40%', '70%'],
                            avoidLabelOverlap: false,
                            itemStyle: {
                                borderRadius: 10,
                                borderColor: '#0a0e27',
                                borderWidth: 2
                            },
                            label: {
                                show: true,
                                formatter: '{b}: {c}ä¸ª\n({d}%)',
                                color: '#cbd5e1'
                            },
                            data: [
                                { value: 125, name: 'æ­£å¸¸', itemStyle: { color: '#10b981' } },
                                { value: 18, name: 'åä½', itemStyle: { color: '#f59e0b' } },
                                { value: 3, name: 'ç¼ºè´§', itemStyle: { color: '#ef4444' } },
                                { value: 12, name: 'ç§¯å‹', itemStyle: { color: '#8b5cf6' } }
                            ]
                        }]
                    };
                    chart.setOption(option);
                    window.addEventListener('resize', () => chart.resize());
                },
                renderDemandChart() {
                    const chart = echarts.init(this.$refs.demandChart);

                    const dates = [];
                    const forecast = [];
                    const lower = [];
                    const upper = [];

                    for (let i = 1; i <= 30; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() + i);
                        dates.push(date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' }));

                        const base = 100 + Math.random() * 20;
                        forecast.push(Math.round(base));
                        lower.push(Math.round(base * 0.85));
                        upper.push(Math.round(base * 1.15));
                    }

                    const option = {
                        tooltip: {
                            trigger: 'axis',
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            borderColor: 'rgba(99, 102, 241, 0.3)',
                            textStyle: { color: '#e2e8f0' }
                        },
                        legend: {
                            data: ['é¢„æµ‹éœ€æ±‚', 'ç½®ä¿¡åŒºé—´'],
                            textStyle: { color: '#94a3b8' }
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        xAxis: {
                            type: 'category',
                            data: dates,
                            axisLine: { lineStyle: { color: 'rgba(99, 102, 241, 0.3)' } },
                            axisLabel: { color: '#94a3b8', rotate: 45 }
                        },
                        yAxis: {
                            type: 'value',
                            name: 'éœ€æ±‚é‡(ç›’)',
                            nameTextStyle: { color: '#94a3b8' },
                            axisLine: { lineStyle: { color: 'rgba(99, 102, 241, 0.3)' } },
                            axisLabel: { color: '#94a3b8' },
                            splitLine: { lineStyle: { color: 'rgba(99, 102, 241, 0.1)' } }
                        },
                        series: [
                            {
                                name: 'é¢„æµ‹éœ€æ±‚',
                                type: 'line',
                                data: forecast,
                                smooth: true,
                                itemStyle: { color: '#3b82f6' },
                                areaStyle: {
                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                        { offset: 0, color: 'rgba(59, 130, 246, 0.3)' },
                                        { offset: 1, color: 'rgba(59, 130, 246, 0.05)' }
                                    ])
                                }
                            },
                            {
                                name: 'ç½®ä¿¡åŒºé—´',
                                type: 'line',
                                data: upper,
                                lineStyle: { opacity: 0 },
                                areaStyle: {
                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                        { offset: 0, color: 'rgba(251, 191, 36, 0.1)' },
                                        { offset: 1, color: 'rgba(251, 191, 36, 0.02)' }
                                    ])
                                },
                                stack: 'confidence',
                                silent: true
                            }
                        ]
                    };
                    chart.setOption(option);
                    window.addEventListener('resize', () => chart.resize());
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
